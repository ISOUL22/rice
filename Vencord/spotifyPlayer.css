/**
 * @name Improved Spotify Player
 * @description A visual overhaul of the Vencord Spotify Player plugin.
 * @author Soul
 * @version who fucking knows lol
 * @website 
 * @source 
*/

/*---===< COVER ART AS BACKGROUND >===---*/
#vc-spotify-player {
  transition: all 0.4s ease-out;
  border: none;
  border-radius: 15px;
  background: var(
    --bg-overlay-floating,
    var(--background-base-low, var(--background-secondary-alt))
  );
  overflow: hidden;

  /* layer all children above background */
  > * {
    position: relative;
    z-index: 1;
  }
}

/* album cover as background using pseudo-elements */
#vc-spotify-player::before {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 0;
  filter: blur(2px) brightness(0.6);
  transition: filter 0.3s ease;
  /* subtle blur + darken for text readability */
  border-radius: inherit;
  background-image: var(--vc-spotify-track-image);
  background-position: center;
  background-size: cover;
  background-repeat: no-repeat;
  width: 100%;
  height: 100%;
  content: "";
}

/* fade towards bottom */
#vc-spotify-player::after {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 0;
  border-radius: inherit;
  background: linear-gradient(to bottom, transparent 0%, #1e1e2ecc 100%);
  width: 100%;
  height: 100%;
  pointer-events: none;
  content: "";
}

/* hide the original album image */
#vc-spotify-info-wrapper > img,
#vc-spotify-player:not(:has(#vc-spotify-album-expanded-wrapper)):hover
  #vc-spotify-album-image {
  display: none;
}

/*---===< ICONS >===---*/
#vc-spotify-song-title::before,
#vc-spotify-song-title + div::before,
#vc-spotify-song-title + div + div::before {
  position: absolute;
  -webkit-mask-size: contain;
  margin-left: -17px;
  background-color: white;
  padding: 7px;
  content: "";
}

#vc-spotify-song-title + div::before,
#vc-spotify-song-title + div + div::before {
  background-color: white;
}

#vc-spotify-song-title::before {
  -webkit-mask-image: url("https://raw.githubusercontent.com/ISOUL22/rice/refs/heads/main/Vencord/assets/music-note.svg");
}

#vc-spotify-song-title + div::before {
  -webkit-mask-image: url("https://raw.githubusercontent.com/ISOUL22/rice/refs/heads/main/Vencord/assets/user.svg");
}

#vc-spotify-song-title + div + div::before {
  -webkit-mask-image: url("https://raw.githubusercontent.com/ISOUL22/rice/refs/heads/main/Vencord/assets/disc-alt.svg");
}

/* the song info */
#vc-spotify-player #vc-spotify-titles {
  margin-left: 16px;
}

#vc-spotify-song-title::before,
#vc-spotify-song-title + div::before,
#vc-spotify-song-title + div + div::before {
  background-color: white;
}

/*---===< PROGRESS BAR >===---*/
#vc-spotify-progress-bar
  > [class^="slider_"]
  > [class^="bar_"]
  > [class^="barFill_"] {
  filter: blur(2px) brightness(100%);
  background-color: white !important;
  background: var(--vc-spotify-track-image);
  background-size: 2px 100%;
}

#vc-spotify-player .bar_a562c8 {
  background-color: hsl(var(--white-500-hsl) / 0.1);
}

#vc-spotify-progress-bar {
  margin: 0 0 -15px;
}

/* hide durations */
.vc-spotify-progress-time {
  display: none;
}

/*---===< BUTTONS >===---*/
.vc-spotify-button-row {
  margin-bottom: -10px;
}

.vc-spotify-button-row button:last-child {
  margin-right: 0;
}

.vc-spotify-button-row button:hover {
  background-color: var(--bg-1);
}

.vc-spotify-button-row {
  .vc-spotify-button {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-right: 8px;
    border: 1px solid var(--border-faint);
    background-color: var(--button-secondary-background);
    width: 50px;
    color: var(--text-3);

    svg {
      display: block;
      transform: scale(1.3);
      width: 60%;
      height: 60%;
    }

    &[class*="shuffle"] {
      path {
        d: path(
          "m 12.5 14.723 l 0.98 -1.167 l 0.957 1.14 a 2.25 2.25 0 0 0 1.724 0.804 h 1.947 l -1.017 -1.018 a 0.75 0.75 0 1 1 1.06 -1.06 l 2.829 2.828 l -2.829 2.828 a 0.75 0.75 0 1 1 -1.06 -1.06 L 18.109 17 H 16.16 A 3.75 3.75 0 0 1 13.287 15.66 L 12.5 14.722 Z m 5.651 -9.801 a 0.75 0.75 0 1 0 -1.06 1.06 L 18.109 7 H 16.16 A 3.75 3.75 0 0 0 13.287 8.34 L 7.114 15.696 A 2.25 2.25 0 0 1 5.39 16.5 H 5 V 18 H 5.391 A 3.75 3.75 0 0 0 8.264 16.66 L 14.437 9.304 A 2.25 2.25 0 0 1 16.161 8.5 h 1.947 l -1.017 1.018 a 0.75 0.75 0 0 0 1.06 1.06 L 20.98 7.75 L 18.15 4.922 Z M 5.391 7.5 H 5 V 6 H 5.391 C 6.5 6 7.551 6.49 8.264 7.34 L 9.89 9.277 L 8.911 10.444 L 7.115 8.304 A 2.25 2.25 0 0 0 5.39 7.5 Z"
        );
      }

      &:not([class*="off"]) {
        color: var(--vc-spotify-green);
      }
    }

    &[class*="repeat"] {
      .vc-spotify-repeat-1 {
        margin-top: -9px;
        font-size: 50%;
      }

      path {
        d: path(
          "M 5 9.75 A 3.75 3.75 0 0 1 8.75 6 h 8.5 A 3.75 3.75 0 0 1 21 9.75 v 5 a 3.75 3.75 0 0 1 -3.75 3.75 H 14.81 l 1.018 1.018 a 0.75 0.75 0 1 1 -1.06 1.06 L 11.939 17.75 l 2.829 -2.828 a 0.75 0.75 0 1 1 1.06 1.06 L 14.811 17 h 2.439 a 2.25 2.25 0 0 0 2.25 -2.25 v -5 a 2.25 2.25 0 0 0 -2.25 -2.25 h -8.5 A 2.25 2.25 0 0 0 6.5 9.75 v 5 A 2.25 2.25 0 0 0 8.75 17 H 10 v 1.5 H 8.75 A 3.75 3.75 0 0 1 5 14.75 v -5 z"
        );
      }

      &:not([class*="off"]) {
        color: var(--vc-spotify-green);
      }
    }
  }
}

/* panel order */
[class^="sidebar_"] section[class^="panels_"] {
  display: flex;
  flex-direction: column;

  #vc-spotify-player {
    order: -1;
  }
}
